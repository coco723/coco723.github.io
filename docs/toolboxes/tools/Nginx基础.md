# Nginx基础

nginx是一款自由的、开源的、高性能的HTTP服务器和反响代理服务器；同时也是一个IMAP、POP3、SMT代理服务器。

Nginx可以作为一个HTTP服务器进行网站的发布处理，另外Nginx可以作为反向代理进行负载均衡的实现。

## 正向代理

用途：
- 访问原来无法访问的资源，如Google
- 可以作为缓存，加速访问资源。
- 对客户端访问授权，上网进行认证
- 代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息

## 反向代理

明白了什么是正向代理，我们继续看关于反向代理的处理方式，举例如我国的某宝网站，每天同时连接到网站的访问人数已经爆表，单个服务器远远不能满足人民日益增长的购买欲望了。

此时就出现了一个大家耳熟能详的名词：分布式部署；也就是通过部署多台服务器来解决访问人数限制的问题。

某宝网站中大部分功能也是直接使用 Nginx 进行反向代理实现的，并且通过封装 Nginx 和其他的组件之后起了个高大上的名字：Tengine。

有兴趣的童鞋可以访问 Tengine 的官网查看具体的信息：

```
http://tengine.taobao.org/
```

![](https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-05-6cd3eb9ca7febbcc10ee3d485dcecb68.jpg)

客户端是无感知代理的存在的，反向代理对外都是透明的，访问者并不知道自己访问的是一个代理。因为客户端不需要任何配置就可以访问。

方向代理的作用：

- 保证内网的安全，通常将方向代理作为公网访问地址，Web服务器是内网
- 负载均衡，通过反向代理服务器来优化网站的负载


通常情况下，我们在实际项目操作时，正向代理和反向代理很有可能会存在同一个应用场景中，正向代理代理客户端的请求去访问目标服务器，目标服务器是一个反向单利服务器，反向代理了多台真实的业务处理服务器。


![](https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-05-a8552f1c0e53a5a813083fc8a5a80c16.jpg)

**负载均衡**

这里提到的客户端发送的、Nginx反向代理服务器接收到的请求数量，就是我们说的负载量

请求数量按照一定的规则进行分发，到不同的服务器处理的规则，就是一种均衡规则/

所以将服务器接收到的请求按照规则分发的过程，称为负载均衡。

负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种，硬件负载均衡也称为硬负载，如F5负载均衡，相对造价昂贵成本较高

但是数据稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作。

**Nginx 支持的负载均衡调度算法方式如下：**

1) weight轮询（默认)：接收到的请求按照顺序逐一分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，Nginx 会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。

这种方式下，可以给不同的后端服务器设置一个权重值（weight），用于调整不同的服务器上请求的分配率。

权重数据越大，被分配到请求的几率越大；该权重值主要是针对实际工作环境中不同后端服务器一件配置进行调整的。

2）ip_hash：每个请求按照发起客户端的IP的hash结果进行匹配，这样的算法下一个固定IP地址的客户端总会访问到同一个后端服务器，这也在一定成都上解决了集群部署环境下Session共享的问题。

3） fair： 只能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配。

响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少，它是结合了前两者的优点的一种调度算法。

但是需要注意的是Nginx默认不支持fair算法，如果要使用这种调度算法，请安装upstream_fair模块。

4） url_hash：按照访问的URL的hash结果分配请求，每个请求的URL会指向后端固定的某个服务器，可以在Nginx作为静态服务器的情况下提高缓存效率/


同样要注意Nginx默认不支持这种调度算法，要使用的话需要安装Nginx的哈说软件包

**Web 服务器对比**


![](https://gcc68.oss-cn-hangzhou.aliyuncs.com/2019-11-05-3d38228ddfee5a9c877f8b14d5d3f602.jpg)
