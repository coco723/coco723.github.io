(window.webpackJsonp=window.webpackJsonp||[]).push([[175],{593:function(t,s,a){"use strict";a.r(s);var e=a(2),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"如何保存价值上千万的node源代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何保存价值上千万的node源代码"}},[t._v("#")]),t._v(" 如何保存价值上千万的Node源代码")]),t._v(" "),s("h2",{attrs:{id:"甲方突然要求做私有化部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#甲方突然要求做私有化部署"}},[t._v("#")]),t._v(" 甲方突然要求做私有化部署")]),t._v(" "),s("p",[t._v("项目用node做的，node代码需要保护吗？")]),t._v(" "),s("p",[t._v("一般情况下不需要，因为代码跑在云端服务器上，只要服务器安全，node代码哪怕是铭文，也是安全的")]),t._v(" "),s("p",[t._v("假如某天甲方突然要求做私有化部署，而你老板爽快地答应了，并把这个问题丢给你。")]),t._v(" "),s("p",[t._v("好吧，现在情况改变了，你需要代码部署在不信任的环境。一旦把Node.js源代码在甲方的服务器进行打包或上线，那甲方就可以轻易地查看，分析，篡改和复制你的代码。")]),t._v(" "),s("h2",{attrs:{id:"于是开始谷歌"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#于是开始谷歌"}},[t._v("#")]),t._v(" 于是开始谷歌")]),t._v(" "),s("p",[t._v("有哪些方法可以保护js代码？")]),t._v(" "),s("h3",{attrs:{id:"_1-加密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-加密"}},[t._v("#")]),t._v(" 1. 加密")]),t._v(" "),s("p",[t._v("我们可以对js代码进行加密，每次执行前进行解密，实际运行的是解密后的代码，但是加密对执行效率会有影响，而且一旦密码被破解，源码就泄露了")]),t._v(" "),s("h3",{attrs:{id:"_2-混淆"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-混淆"}},[t._v("#")]),t._v(" 2. 混淆")]),t._v(" "),s("p",[t._v("对代码进口行混淆，尽量地让代码变得不可读，据说这个思路是从代码写的很差的程序员身上学来的。常见的做法有：分离常量、打乱控制流、增加无意义代码、域名锁定、混淆字符串，禁用调试方法。")]),t._v(" "),s("h3",{attrs:{id:"_3-编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-编译"}},[t._v("#")]),t._v(" 3. 编译")]),t._v(" "),s("p",[t._v("node代码是通过V8引擎来执行的，而V8引擎会将node代码编译成字节码（bytenode）之后再解释执行。如果我们能将node代码编译成字节码，将会进一步提高代码的安全性。毕竟反编译V8的字节码并非易事")]),t._v(" "),s("h3",{attrs:{id:"_4-打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-打包"}},[t._v("#")]),t._v(" 4. 打包")]),t._v(" "),s("p",[t._v("把node代码和依赖，打包成一个可执行文件。这样可以增加一点破解的难度")]),t._v(" "),s("h2",{attrs:{id:"然后从github上抄代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#然后从github上抄代码"}},[t._v("#")]),t._v(" 然后从GitHub上抄代码")]),t._v(" "),s("p",[t._v("这里列出几个与js混淆，编译，打包相关的库或网站：")]),t._v(" "),s("h3",{attrs:{id:"_1-混淆"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-混淆"}},[t._v("#")]),t._v(" 1. 混淆")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("一个强大的JS混淆器\n"),s("a",{attrs:{href:"https://github.com/javascript-obfuscator/javascript-obfuscator",title:"Github",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gihttps://github.com/javascript-obfuscator/javascript-obfuscator thub"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("一套JS代码安全问题解决方案")])])]),t._v(" "),s("p",[s("a",{attrs:{href:"http://www.jshaman.com/",title:"http://www.jshaman.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.jshaman.com/"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_2-编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译"}},[t._v("#")]),t._v(" 2. 编译")]),t._v(" "),s("ul",[s("li",[t._v("一个极简的Node字节码编译器")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/OsamaAbbas/bytenode",title:"Github",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/OsamaAbbas/bytenode"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_3-打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-打包"}},[t._v("#")]),t._v(" 3. 打包")]),t._v(" "),s("p",[t._v("-ncc可以把node项目打包成一个JS但文件，支持TypeScript，动态导入。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/zeit/ncc",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/zeit/ncc"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[t._v("[pkg]可以把node项目打包成一个二进制的可执行文件，pkg不支持动态导入，但是会将Node本身一起打包，可以实现再没安装node的环境运行")])]),t._v(" "),s("p",[t._v("[https://github.com/zeit/pkg](https://github.com/zeit/pkg Github)")]),t._v(" "),s("ul",[s("li",[t._v("[pmq20/node-packer]也能打包成一个二进制的可执行文件，它的优势在于支持各种形式的require, 也支持C++模块。可惜项目已经两年没更新了，只支持到Node.js 8.3.0, 对于更高版本的支持，请移步"),s("a",{attrs:{href:"slee047/node-packer"}},[t._v("slee047/node-packer")]),t._v("。")])]),t._v(" "),s("p",[t._v("[https://github.com/pmq20/node-packer](https://github.com/pmq20/node-packer github)")]),t._v(" "),s("h2",{attrs:{id:"选出一个方法交差"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选出一个方法交差"}},[t._v("#")]),t._v(" 选出一个方法交差")]),t._v(" "),s("p",[t._v("没有绝对的安全可言，以上的方法只能是加大破解的难度。有道是世上无难事只怕有心人，只要有足够的技术和耐心，还是有可能还原出相应的代码。")]),t._v(" "),s("p",[t._v("作为防守方，我们能做是尽可能地多采用一些保护手段。在这里，提供一个JavaScript obfuscator + bytenode + node-packer的解决方案。")]),t._v(" "),s("p",[t._v("为什么选用node-packer而不是ncc，pkg呢？因为ncc和pkg无法处理混淆过的代码。")]),t._v(" "),s("h2",{attrs:{id:"保护价值上千万的代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#保护价值上千万的代码"}},[t._v("#")]),t._v(" 保护价值上千万的代码")]),t._v(" "),s("p",[t._v("假设我们需要保护的是这样的一个项目：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// index.js")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"以下是价值上千万的代码:"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1 + 1 = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("首先我们通过npm安装javascript-obfuscator 和 bytenode。然后在当前系统下安装node-packer。")]),t._v(" "),s("p",[t._v("由于node-packer无法打包由bytenode生成的.jsc字节码文件，所以需要添加以下文件来导入.jsc文件：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// build.js")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bytenode'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./index-obfuscated.jsc'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("接着将以下指令加到package.json:")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"obfuscate"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"javascript-obfuscator index.js --string-array-encoding rc4"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"bytenode"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bytenode --compile index-obfuscated.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"nodec"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nodec build.js --skip-npm-install"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"build"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm run obfuscate && npm run bytenode && npm run nodec"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("最后运行"),s("code",[t._v("npm run build")]),t._v("，可以得到一个"),s("code",[t._v("a.out")]),t._v("（windows系统下是"),s("code",[t._v("a.exe")]),t._v("）的可执行文件。运行一下，价值上千万的代码就跑起来了。")]),t._v(" "),s("p",[t._v("此外你会发现项目目录下多了两个文件："),s("code",[t._v("index-obfuscated.js")]),t._v(", "),s("code",[t._v("index-obfuscated.jsc")]),t._v("。它们分别是混淆之后的代码以及字节码文件。javascript-obfuscator支持多种混淆技术，可能通过查看文档，按照自己的项目需求，调配选用合适的选项。")]),t._v(" "),s("h2",{attrs:{id:"结语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[t._v("#")]),t._v(" 结语")]),t._v(" "),s("p",[t._v("除了以上技术手段，别忘了加上license，注明版权信息。")]),t._v(" "),s("p",[t._v("感谢看到最后，最后我将为你提供这份价值上千万的代码示例。项目地址是")]),t._v(" "),s("p",[t._v("[https://github.com/iWinston/javascript-code-protection-example](https://github.com/iWinston/javascript-code-protection-example github)")])])}),[],!1,null,null,null);s.default=n.exports}}]);